<!DOCTYPE html>
<html>
  <head>
    <title>図書管理システム CloudBib</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://www.cloudbib.net/css/default.css" />
    <script src="https://www.cloudbib.net/js/util.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.3.0/jquery.form.min.js"
      integrity="sha384-qlmct0AOBiA2VPZkMY3+2WqkHtIQ9lSdAsAn5RUJD/3vA5MKDgSGcdmIv4ycVxyn"
      crossorigin="anonymous"
    ></script>

    <script>
      function get_link(data) {
        $("#logoutForm").submit();
      }

      $(document).ready(function () {
        var options = {
          dataType: "json",
          success: processJson,
        };
        $("#logoutForm").ajaxForm(options);
        $("#form1").ajaxForm(options);
        $("#form2").ajaxForm(options);
        $("#form3").ajaxForm(options);
        $("#form4").ajaxForm(options);

        var options2 = {
          dataType: "json",
          success: processGet,
        };
        $("#getForm").ajaxForm(options2);

        var options3 = {
          dataType: "json",
          success: processDelete,
        };
        $("#deleteForm").ajaxForm(options3);

        document.getElementById("invisible_submit").click();
        document.getElementsByClassName("accordion")[0].click();
      });

      function processJson(data) {
        if (handleAuthError(data)) {
          return;
        }
        if (handleError(data)) {
          return;
        }
        alert("変更しました");
      }

      function processGet(data) {
        if (handleAuthError(data)) {
          return;
        }
        if (handleError(data)) {
          return;
        }

        document.getElementById("uname").value = data["uname"];
        document.getElementById("email").value = data["email"];
      }

      function processDelete(data) {
        if (isAuthError(data)) {
          alert("アカウントを削除しました");
          handleAuthError(data);
          return;
        }

        if (handleError(data)) {
          return;
        }
      }
    </script>
  </head>

  <body>
    <form id="logoutForm" name="logoutForm" action="/auth/logout" method="post">
      <input type="submit" id="invisible_logout" style="display: none" />
    </form>

    <form id="getForm" name="getForm" action="/account/get" method="get">
      <input type="submit" id="invisible_submit" style="display: none" />
    </form>

    <div class="topnav">
      <a class="active" href="/">製品ホーム</a>
      <a href="/search/manual">マニュアル</a>
      <a
        href="https://twitter.com/messages/compose?recipient_id=1618571454580137984"
        >問い合わせ</a
      >
      <div class="topnav-right">
        <a href="javascript:{}" onclick="javascript:get_link();">ログアウト</a>
      </div>
    </div>

    <h3 style="color: #666666">管理者メニュー</h3>
    <hr />
    <a href="/login/"><font size="-1">司書・利用者としてログインする</font></a>

    <div class="container">
      <div class="full-container">
        <button class="accordion">利用プラン</button>
        <div class="panel">
          <form id="form5" name="form5" action="/account/update" method="post">
            <label for="uname"><b>契約中の利用プラン</b></label
            ><input type="text" value="フリー (無料)" />

            <label for="planList"><b>変更後の利用プラン</b></label>
            <select id="planList" name="planlist">
              <option value="red">フリー (無料)</option>
            </select>
            <br />
            <font size="-1" style="color: gray"
              >現在は、無料プランのみ提供しております。</font
            ><br />
            <br />
            <button type="submit" class="submitbtn" disabled>
              利用プランを変更
            </button>
          </form>
        </div>

        <button class="accordion">ユーザー名・メールアドレス</button>
        <div class="panel">
          <form id="form1" name="form1" action="/account/update" method="post">
            <label for="uname"><b>ユーザー名</b></label>
            <input type="text" readonly name="uname" id="uname" /><br />
            <font size="-1" style="color: gray">ユーザ名は変更できません。</font
            ><br />
            <br />
            <label for="email"><b>メールアドレス</b></label>
            <input type="email" name="email" id="email" />
            <button type="submit" class="submitbtn">
              メールアドレスを変更
            </button>
          </form>
          <form
            id="deleteForm"
            name="deleteForm"
            action="/account/delete"
            method="post"
          >
            <button
              type="submit"
              class="submitbtn"
              onClick="return confirm('アカウントを削除すると、登録したすべてのデータが削除されますがよろしいですか？');"
            >
              アカウントを削除
            </button>
          </form>
        </div>

        <button class="accordion">管理者パスワード</button>
        <div class="panel">
          <form
            id="form3"
            name="form3"
            action="/account/admin_password"
            method="post"
            onsubmit="return postPasswordForm('form3', 'password', 'confirm_password', 8)"
          >
            <input type="hidden" name="uname" id="uname" value="{{UNAME}}" />
            <label for="password"><b>管理者パスワード</b></label>
            <input type="password" name="password" id="password" required />
            <br />
            <font size="-1" style="color: gray"
              >半角英数、数字、記号を組み合わせて８文字以上で入力してください。</font
            ><br />
            <br />
            <label for="password"><b>管理者パスワード (確認用)</b></label>
            <input
              type="password"
              id="confirm_password"
              name="confirm_password"
              required
            />
            <button type="submit" class="submitbtn">
              管理者パスワードを変更
            </button>
          </form>
          <hr />
        </div>

        <button class="accordion">司書パスワード</button>
        <div class="panel">
          <form
            id="form4"
            name="form4"
            action="/account/operator_password"
            method="post"
            onsubmit="return postPasswordForm('form4', 'operator_password', 'confirm_operator_password', 8)"
          >
            <input type="hidden" name="uname" id="uname" value="{{UNAME}}" />
            <label for="operator_password"><b>司書パスワード</b></label>
            <input
              type="password"
              name="operator_password"
              id="operator_password"
              required
            />
            <br />
            <font size="-1" style="color: gray"
              >半角英数、数字、記号を組み合わせて８文字以上で入力してください。<br />初期設定では、管理者パスワードと同じ値が設定されています。</font
            ><br />
            <br />
            <label for="password"><b>司書パスワード (確認用)</b></label>
            <input
              type="password"
              id="confirm_operator_password"
              name="confirm_operator_password"
              required
            />
            <button type="submit" class="submitbtn">
              司書パスワードを変更
            </button>
          </form>
          <hr />
        </div>

        <button class="accordion">利用者パスワード</button>
        <div class="panel">
          <form
            id="form5"
            name="form5"
            action="/account/user_password"
            method="post"
            onsubmit="return postPasswordForm('form5', 'user_password', 'confirm_user_password', 8)"
          >
            <input type="hidden" name="uname" id="uname" value="{{UNAME}}" />
            <label for="user_password"><b>利用者パスワード</b></label>
            <input
              type="password"
              name="user_password"
              id="user_password"
              required
            />
            <br />
            <font size="-1" style="color: gray"
              >半角英数、数字、記号を組み合わせて８文字以上で入力してください。<br />初期設定では、管理者パスワードと同じ値が設定されています。</font
            ><br />
            <br />
            <label for="config_user_password"
              ><b>利用者パスワード (確認用)</b></label
            >
            <input
              type="password"
              id="confirm_user_password"
              name="confirm_user_password"
              required
            />
            <button type="submit" class="submitbtn">
              利用者パスワードを変更
            </button>
          </form>
          <hr />
        </div>
      </div>
    </div>

    <script>
      var acc = document.getElementsByClassName("accordion");
      var i;

      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
          this.classList.toggle("active");
          var panel = this.nextElementSibling;
          if (panel.style.display === "block") {
            panel.style.display = "none";
          } else {
            panel.style.display = "block";
          }
        });
      }
    </script>
  </body>
</html>
